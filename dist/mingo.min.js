"use strict";function _defineProperty(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_slicedToArray=function(){function n(n,t){var e=[],r=!0,u=!1,i=void 0;try{for(var o,l=n[Symbol.iterator]();!(r=(o=l.next()).done)&&(e.push(o.value),!t||e.length!==t);r=!0);}catch(a){u=!0,i=a}finally{try{!r&&l["return"]&&l["return"]()}finally{if(u)throw i}}return e}return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function n(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();!function(n){function t(n,t,e){e=e||{},e.root=e.root||a(n);var r=m(n,t,null,e);return En.includes(r)?In[r](n,t,e):r}function e(n,t){return n[t]}function r(n,t,u){var i=t.split("."),o=n,l=function(n){var t=E(i[n].match(/^\d+$/));if(t&&j(o)){if(u===!0&&0===n)return{v:o};o=o.map(function(t){return r(t,i[n],!0)}),1===o.length&&(o=o[0])}else o=e(o,i[n]),u=!1;return q(o)?"break":void 0};n:for(var a=0;a<i.length;a++){var s=l(a);switch(s){case"break":break n;default:if("object"===("undefined"==typeof s?"undefined":_typeof(s)))return s.v}}return o}function u(n,t){if(!q(n)){var r=t.split("."),i=r[0],o=1===r.length||r.slice(1).join("."),l=null!==i.match(/^\d+$/),a=void 0,s=void 0;try{1===r.length?j(n)?l?(a=e(n,i),_(a),a=[a]):(a=[],J(n,function(n){s=u(n,t),q(s)||a.push(s)}),b(a.length>0)):(s=e(n,i),_(s),a={},a[i]=s):j(n)?l?(a=e(n,i),a=u(a,o),_(a),a=[a]):(a=[],J(n,function(n){s=u(n,t),q(s)||a.push(s)}),b(a.length>0)):(s=e(n,i),s=u(s,o),_(s),a={},a[i]=s)}catch(c){a=void 0}return a}}function i(n,t,e,r){var u=t.split("."),o=u[0],l=1===u.length||u.slice(1).join("."),a=/^\d+$/.test(o);if(1===u.length)e(n,o);else if(j(n)&&!a)J(n,function(n){return i(n,t,e,r)});else{if(r===!0){var s=F(n,o);s&&!P(n[o])||(n[o]={})}i(n[o],l,e,r)}}function o(n,t,e){i(n,t,function(n,t){n[t]=e})}function l(n,t){i(n,t,function(n,t){j(n)&&/^\d+$/.test(t)?n.splice(parseInt(t),1):M(n)&&delete n[t]})}function a(n){switch(B(n)){case"array":return n.map(a);case"object":return G(n,a);default:return n}}function s(n){for(var t=0;t<Qn.length;t++)if(Qn[t](n))return!0;return!1}function c(n){return s(n)||!A(n)}function f(n){if(c(n))return I(n)?{$regex:n}:{$eq:n};if(A(n)){var t=z(n),e=0===H(d(qn),t).length;if(e)return{$eq:n};if(t.includes("$regex")){var r=n.$regex,u=n.$options||"",i="";w(r)&&(i+=r.ignoreCase||u.indexOf("i")>=0?"i":"",i+=r.multiline||u.indexOf("m")>=0?"m":"",i+=r.global||u.indexOf("g")>=0?"g":"",r=new RegExp(r,i)),n.$regex=r,delete n.$options}}return n}function v(n,t){return new Array(Math.max(t-String(n).length+1,0)).join("0")+n}function d(n){return z(Ln[n])}function h(n,t,e){for(var r={},u=[],i=void 0,o=void 0,l=void 0,s=n.length,c=0;s>c;c++)o=n[c],i=t.call(e,o,c),l=$(o),F(r,l)||(r[l]=[i,c]),u.push(a(o));return u.sort(function(n,t){var e=r[$(n)],u=r[$(t)];return e[0]<u[0]?-1:e[0]>u[0]?1:e[1]<u[1]?-1:e[1]>u[1]?1:0}),b(u.length===n.length,"sortBy must retain collection length"),u}function p(n,t,e){var r={keys:[],groups:[]},u={};return J(n,function(n){var i=t.call(e,n),o=$(i),l=-1;q(u[o])&&(l=r.keys.length,u[o]=l,r.keys.push(i),r.groups.push([])),l=u[o],r.groups[l].push(n)}),b(r.keys.length===r.groups.length,"Cardinality must be equal for groups and keys"),r}function g(n){return an({"":n})+B(n)+n}function $(n){var t=void 0,e=void 0,r=void 0,u=0,i=g(n);if(0===i.length)return u;for(t=0,r=i.length;r>t;t++)e=i.charCodeAt(t),u=(u<<5)-u+e,u|=0;return u.toString()}function y(n,t,e){if(d(Pn).includes(t))return yn[t](n,e);if(M(e)){var r={};for(var u in e)if(F(e,u)&&(r[u]=y(n,u,e[u]),d(Pn).includes(u))){r=r[u],z(e).length>1&&Y("Invalid $group expression '"+an(e)+"'");break}return r}}function m(n,t,e,u){if(u=u||{},u.root=u.root||a(n),d(Dn).includes(e))return An[e](n,t,u);if(d(Pn).includes(e))return n=m(n,t,null,u),b(j(n),"Must use collection type with "+e+" operator"),yn[e](n,null,u);if(w(t)&&t.length>0&&"$"===t[0]){if(Sn.includes(t))return Cn[t](n,null,u);if(En.includes(t))return t;var i=Sn.filter(function(n){return 0===t.indexOf(n+".")});return 1===i.length&&(i=i[0],"$$ROOT"===i&&(n=u.root),t=t.substr(i.length)),r(n,t.slice(1))}switch(B(t)){case"array":return t.map(function(t){return m(n,t,null)});case"object":var o={};for(var l in t)if(F(t,l)&&(o[l]=m(n,t[l],l,u),d(Dn).includes(l))){b(1===z(t).length,"Invalid aggregation expression '"+an(t)+"'"),o=o[l];break}return o;default:return a(t)}}function b(n,t){L(n)&&Y(t)}function _(n){return b(!q(n))}function x(n,t){b(n===Object(n),t)}function O(n,t){return B(n)===t}function k(n){return O(n,"boolean")}function w(n){return O(n,"string")}function N(n){return O(n,"number")}function j(n){return O(n,"array")}function M(n){return O(n,"object")}function A(n){return n===Object(n)}function C(n){return O(n,"date")}function I(n,t){return O(n,"regexp")}function S(n,t){return O(n,"function")}function E(n){return O(n,"null")}function q(n){return O(n,"undefined")}function P(n){return E(n)||q(n)}function D(n,t){return!n.includes(t)}function R(n,t){return n.includes(t)}function T(n){return!!n}function L(n){return!n}function U(n){return P(n)||j(n)&&0===n.length||M(n)&&0===z(n).length||!n}function Q(n){return j(n)?n:[n]}function B(n){return Object.prototype.toString.call(n).match(/\s(\w+)/)[1].toLowerCase()}function F(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function Y(n){throw new Error(n)}function z(n){return Object.keys(n)}function J(n,t,e){if(x(n,"Cannot iterate over object of type '"+B(n)+"'"),j(n))n.forEach(t,e);else for(var r in n)F(n,r)&&t.call(e,n[r],r)}function G(n,t,e){if(j(n))return n.map(t,e);if(M(n)){for(var r,u={},i=z(n),o=0,l=i.length;l>o;o++)r=i[o],u[r]=t.call(e,n[r],r);return u}Y("Input must be an Array or Object type")}function H(n,t){return n.filter(R.bind(null,t))}function K(n,t){var e=[];return on.apply(e,n),on.apply(e,t.filter(D.bind(null,n))),e}function V(n,t){b(j(n),"Input must be an Array");var e=[],r=function u(n,t){for(var r=0,i=n.length;i>r;r++)j(n[r])&&(t>0||0>t)?u(n[r],Math.max(-1,t-1)):on.call(e,n[r])};return r(n,t||-1),e}function W(n,t){if(n===t)return!0;var e=B(n);if(e!==B(t))return!1;if("number"===e&&isNaN(n)&&isNaN(t))return!0;if(["date","regexp"].includes(e))return n.toString()===t.toString();var r=void 0,u=void 0;if("array"===e){if(n.length===t.length&&0===n.length)return!0;if(n.length!==t.length)return!1;for(r=0,u=n.length;u>r;r++)if(!W(n[r],t[r]))return!1}else{if(![n,t].every(M))return!1;var i=z(n),o=z(t);if(i.length!==o.length)return!1;if(i.sort(),o.sort(),!W(i,o))return!1;for(r=0,u=i.length;u>r;r++){var l=i[r];if(!W(n[l],t[l]))return!1}}return!0}function X(n){var t={},e=[];return J(n,function(n){var r=$(n);F(t,r)||(e.push(n),t[r]=0)}),e}function Z(n){var t=n.dataset,e=n.sampled,r=void 0===e?!1:e,u=t.reduce(function(n,t){return n+t},0),i=t.length||1,o=r===!0?1:0,l=u/(i-o);return Math.sqrt(t.reduce(function(n,t){return n+Math.pow(t-l,2)},0)/i)}function nn(n,t,e){return P(e)?0>t?(t=Math.max(0,n.length+t),e=n.length-t+1):(e=t,t=0):(0>t&&(t=Math.max(0,n.length+t)),b(e>0,"Invalid argument value for $slice operator. Limit must be a positive number"),e+=t),ln.apply(n,[t,e])}var tn="0.10.0",en={},rn=void 0;null!==n&&(rn=n.Mingo),en.noConflict=function(){return n.Mingo=rn,en};var un="undefined"!=typeof module&&module.exports&&"undefined"!=typeof require;un?module.exports=en:n.Mingo=en;var on=Array.prototype.push,ln=Array.prototype.slice,an=JSON.stringify,sn={key:"_id"};en.idKey=function(){return sn.key},en._internal=function(){return{assert:b.bind(null),computeValue:m.bind(null),each:J.bind(null),err:Y.bind(null),falsey:L.bind(null),flatten:V.bind(null),groupBy:p.bind(null),has:F.bind(null),hashcode:$.bind(null),inArray:R.bind(null),intersection:H.bind(null),isArray:j.bind(null),isBoolean:k.bind(null),isDate:C.bind(null),isEmpty:U.bind(null),isEqual:W.bind(null),isFunction:S.bind(null),isNull:E.bind(null),isNumber:N.bind(null),isObject:M.bind(null),isObjectLike:A.bind(null),isRegExp:I.bind(null),isString:w.bind(null),isUndefined:q.bind(null),isUnknown:P.bind(null),keys:z.bind(null),map:G.bind(null),notInArray:D.bind(null),ops:d.bind(null),resolve:r.bind(null),resolveObj:u.bind(null),slice:nn.bind(null),stddev:Z.bind(null),stringify:an.bind(null),sortBy:h.bind(null),truthy:T.bind(null),type:B.bind(null),union:K.bind(null),unique:X.bind(null)}},en.setup=function(n){Object.assign(sn,n||{})};var cn=function(){function n(t,e){_classCallCheck(this,n),this._criteria=t,this._projection=e,this._compiled=[],this._compile()}return _createClass(n,[{key:"_compile",value:function(){if(!U(this._criteria)){b(M(this._criteria),"Criteria must be of type Object");for(var n in this._criteria)if(F(this._criteria,n)){var t=this._criteria[n];if(["$and","$or","$nor","$where"].includes(n))this._processOperator(n,n,t);else{t=f(t);for(var e in t)F(t,e)&&this._processOperator(n,e,t[e])}}}}},{key:"_processOperator",value:function(n,t,e){d(qn).includes(t)?this._compiled.push(hn[t](n,e)):Y("Invalid query operator '"+t+"' detected")}},{key:"test",value:function(n){for(var t=0;t<this._compiled.length;t++)if(!this._compiled[t].test(n))return!1;return!0}},{key:"find",value:function(n,t){return new en.Cursor(n,this,t)}},{key:"remove",value:function(n){for(var t=[],e=0;e<n.length;e++)this.test(n[e])||t.push(n[e]);return t}}]),n}();en.Query=cn;var fn=function(){function n(t,e,r){_classCallCheck(this,n),this._query=e,this._collection=t,this._projection=r||e._projection,this._operators={},this._result=!1,this._position=0}return _createClass(n,[{key:"_fetch",value:function(){var n=this;if(this._result!==!1)return this._result;M(this._projection)&&Object.assign(this._operators,{$project:this._projection}),j(this._collection)||Y("Input collection is not of valid type. Must be an Array."),this._result=this._collection.filter(this._query.test,this._query);var t=[];if(J(["$sort","$skip","$limit","$project"],function(e){if(F(n._operators,e)){var r={};r[e]=n._operators[e],t.push(r)}}),t.length>0){var e=new en.Aggregator(t);this._result=e.run(this._result,this._query)}return this._result}},{key:"all",value:function(){return this._fetch()}},{key:"first",value:function(){return this.count()>0?this._fetch()[0]:null}},{key:"last",value:function(){return this.count()>0?this._fetch()[this.count()-1]:null}},{key:"count",value:function(){return this._fetch().length}},{key:"skip",value:function(n){return Object.assign(this._operators,{$skip:n}),this}},{key:"limit",value:function(n){return Object.assign(this._operators,{$limit:n}),this}},{key:"sort",value:function(n){return Object.assign(this._operators,{$sort:n}),this}},{key:"next",value:function(){return this.hasNext()?this._fetch()[this._position++]:null}},{key:"hasNext",value:function(){return this.count()>this._position}},{key:"max",value:function(n){return yn.$max(this._fetch(),n)}},{key:"min",value:function(n){return yn.$min(this._fetch(),n)}},{key:"map",value:function(n){return this._fetch().map(n)}},{key:"forEach",value:function(n){this._fetch().forEach(n)}}]),n}();en.Cursor=fn;var vn=function(){function n(t){_classCallCheck(this,n),this._operators=t}return _createClass(n,[{key:"run",value:function(n,t){if(!U(this._operators))for(var e=0;e<this._operators.length;e++){var r=this._operators[e],u=z(r);if(1===u.length&&d(Rn).includes(u[0])){u=u[0];var i={pipelineOp:u};n=t instanceof en.Query?dn[u].call(t,n,r[u],i):dn[u](n,r[u],i)}else Y("Invalid aggregation operator '"+u+"'")}return n}}]),n}();en.Aggregator=vn,en.find=function(n,t,e){return new en.Query(t).find(n,e)},en.remove=function(n,t){return new en.Query(t).remove(n)},en.aggregate=function(n,t){return j(t)||Y("Aggregation pipeline must be an array"),new en.Aggregator(t).run(n)},en.addOperators=function(n,t){var e=t(Object.assign({idKey:function(){return sn.key}},en._internal()));b([Dn,Pn,Rn,Tn,qn].includes(n),"Could not identify operator class "+n);var u=d(n);J(e,function(t,e){b(/^\$\w+$/.test(e),"Invalid operator name '"+e+"'"),b(!u.includes(e),"Operator "+e+" is already defined for "+n+" operators")});var i={};switch(n){case qn:J(e,function(n,t){i[t]=function(n,t,e){return function(u,i){return{test:function(o){var l=r(o,u),a=n.call(t,u,l,i);return k(a)?a:a instanceof en.Query?a.test(o):void Y("Invalid return type for '"+e+". Must return a Boolean or Mingo.Query")}}}}(n,e,t)});break;case Tn:J(e,function(n,t){i[t]=function(n,t){return function(e,u,i){var o=r(e,i);return n.call(t,i,o,u)}}(n,e)});break;default:J(e,function(n,t){i[t]=function(n,t){return function(){for(var e=arguments.length,r=Array(e),u=0;e>u;u++)r[u]=arguments[u];var i=ln.call(r);return n.apply(t,i)}}(n,e)})}Object.assign(Ln[n],i)},en.CollectionMixin={query:function(n,t){return en.find(this.toJSON(),n,t)},aggregate:function(n){return en.aggregate.call(null,this.toJSON(),n)}};var dn={$addFields:function(n,t){var e=z(t);return n.map(function(n){return n=a(n),J(e,function(e){var r=t[e],u=void 0;if(M(r)){var o=z(r),l=o.filter(function(n){return 0===n.indexOf("$")});U(l)||(b(1===o.length,"Can have only one root operator in $addFields"),l=l[0],r=r[l],u=m(n,r,l))}else u=m(n,r,null);i(n,e,function(n,t){n[t]=u},!0)}),n})},$group:function(n,t){var e=t[sn.key],r=p(n,function(n){return m(n,e,e)}),u=[];return delete t[sn.key],J(r.keys,function(n,e){var i={};q(n)||(i[sn.key]=n);for(var o in t)F(t,o)&&(i[o]=y(r.groups[e],o,t[o]));u.push(i)}),u},$match:function(n,t){return new en.Query(t).find(n).all()},$project:function(n,t){if(U(t))return n;for(var e=[],r=z(t),i=!1,s=[!1,!1],c=0;c<r.length;c++){var f=r[c],v=t[f];f!==sn.key&&(0===v||v===!1?s[0]=!0:s[1]=!0,b(s[0]!==s[1],"Projection cannot have a mix of inclusion and exclusion."))}if(r.includes(sn.key)){var h=t[sn.key];0!==h&&h!==!1||(r=r.filter(D.bind(null,[sn.key])),b(!r.includes(sn.key),"Must not contain collections _id"),i=U(r))}else r.push(sn.key);for(var p=function(s){var c=n[s],f={},v=!1,h=!1,p=[];i&&p.push(sn.key),J(r,function(n){var e=t[n],r=void 0,i=void 0;if(n!==sn.key&&0===e&&(h=!0),n===sn.key&&U(e))r=c[n];else if(w(e))r=m(c,e,n);else if(1===e||e===!0);else{if(!M(e))return void p.push(n);var l=z(e);l=l.length>1?!1:l[0],d(Tn).includes(l)?"$slice"===l?Q(e[l]).every(N)?(r=$n[l](c,e[l],n),v=!0):r=m(c,e,n):r=$n[l](c,e[l],n):r=m(c,e,n)}r=a(r),i=a(u(c,n)),q(i)?q(r)||(f[n]=r):(q(r)||o(i,n,r),Object.assign(f,i))}),(v||h||i)&&(f=Object.assign(a(c),f),J(p,function(n){l(f,n)})),e.push(f)},g=0;g<n.length;g++)p(g);return e},$limit:function(n,t){return n.slice(0,t)},$skip:function(n,t){return n.slice(t)},$unwind:function(n,t){for(var r=[],u=t.substr(1),i=function(t){var i=n[t],o=e(i,u);j(o)?J(o,function(n){var t=a(i);t[u]=n,r.push(t)}):Y("Target field '"+u+"' is not of type Array.")},o=0;o<n.length;o++)i(o);return r},$sort:function(n,t){if(!U(t)&&M(t)){var e=z(t);J(e.reverse(),function(e){var u=p(n,function(n){return r(n,e)}),i={},o=function(n){return i[$(n)]},l=h(u.keys,function(n,t){return i[$(n)]=t,n});-1===t[e]&&l.reverse(),n=[],J(l,function(t){on.apply(n,u.groups[o(t)])})})}return n},$sortByCount:function(n,t){var e={count:{$sum:1}};return e[sn.key]=t,this.$sort(this.$group(n,e),{count:-1})},$sample:function(n,t){var e=t.size;b(N(e),"$sample size must be a positive integer. See https://docs.mongodb.com/manual/reference/operator/aggregation/sample/");for(var r=[],u=0;e>u;u++){var i=Math.floor(Math.random()*n.length);r.push(n[i])}return r},$count:function(n,t){b(w(t)&&""!==t.trim()&&-1===t.indexOf(".")&&"$"!==t.trim()[0],"Invalid expression value for $count. See https://docs.mongodb.com/manual/reference/operator/aggregation/count/");var e={};return e[t]=n.length,e},$replaceRoot:function(n,t){var e=t.newRoot,r=[];return J(n,function(n){n=m(n,e,null),b(M(n),"$replaceRoot expression must return a valid JS object. See https://docs.mongodb.com/manual/reference/operator/aggregation/replaceRoot/"),r.push(n)}),r},$redact:function(n,e){return n.map(function(n){return t(a(n),e)})}},hn={},pn={$and:function(n,t){b(j(t),"Invalid expression: $and expects value to be an Array");var e=[];return J(t,function(n){return e.push(new en.Query(n))}),{test:function(n){for(var t=0;t<e.length;t++)if(!e[t].test(n))return!1;return!0}}},$or:function(n,t){j(t)||Y("Invalid expression for $or criteria");var e=[];return J(t,function(n){return e.push(new en.Query(n))}),{test:function(n){for(var t=0;t<e.length;t++)if(e[t].test(n))return!0;return!1}}},$nor:function(n,t){j(t)||Y("Invalid expression for $nor criteria");var e=this.$or("$or",t);return{test:function(n){return!e.test(n)}}},$not:function(n,t){var e=_defineProperty({},n,f(t)),r=new en.Query(e);return{test:function(n){return!r.test(n)}}},$where:function(n,t){return S(t)||(t=new Function("return "+t+";")),{test:function(n){return t.call(n)===!0}}}};Object.assign(hn,pn);var gn={$eq:function(n,t){return W(n,t)||j(n)&&-1!==n.findIndex(W.bind(null,t))},$ne:function(n,t){return!this.$eq(n,t)},$in:function(n,t){return n=Q(n),H(n,t).length>0},$nin:function(n,t){return q(n)||!this.$in(n,t)},$lt:function(n,t){return n=Q(n).find(function(n){return t>n}),void 0!==n},$lte:function(n,t){return n=Q(n).find(function(n){return t>=n}),void 0!==n},$gt:function(n,t){return n=Q(n).find(function(n){return n>t}),void 0!==n},$gte:function(n,t){return n=Q(n).find(function(n){return n>=t}),void 0!==n},$mod:function(n,t){return n=Q(n).find(function(n){return N(n)&&j(t)&&2===t.length&&n%t[0]===t[1]}),void 0!==n},$regex:function(n,t){return n=Q(n).find(function(n){return w(n)&&I(t)&&!!n.match(t)}),void 0!==n},$exists:function(n,t){return t===!1&&q(n)||t===!0&&!q(n)},$all:function(n,t){var e=this,r=!1;if(j(n)&&j(t))for(var u=0;u<t.length;u++){if(!M(t[u])||!z(t[u]).includes("$elemMatch"))return H(t,n).length===t.length;r=r||e.$elemMatch(n,t[u].$elemMatch)}return r},$size:function(n,t){return j(n)&&N(t)&&n.length===t},$elemMatch:function(n,t){if(j(n)&&!U(n))for(var e=new en.Query(t),r=0;r<n.length;r++)if(e.test(n[r]))return!0;return!1},$type:function(n,t){switch(t){case 1:return N(n)&&-1!==(n+"").indexOf(".");case 2:case 5:return w(n);case 3:return M(n);case 4:return j(n);case 8:return k(n);case 9:return C(n);case 10:return E(n);case 11:return I(n);case 16:return N(n)&&2147483647>=n&&-1===(n+"").indexOf(".");case 18:return N(n)&&n>2147483647&&0x8000000000000000>=n&&-1===(n+"").indexOf(".");default:return!1}}};J(gn,function(n,t){hn[t]=function(n,t){return function(e,u){return{test:function(i){var o=r(i,e);return n.call(t,o,u)}}}}(n,gn)});var $n={$:function(n,t,e){Y("$ not implemented")},$elemMatch:function(n,t,e){var u=r(n,e),i=new en.Query(t);if(!q(u)&&j(u))for(var o=0;o<u.length;o++)if(i.test(u[o]))return[u[o]]},$slice:function(n,t,e){var u=r(n,e);return j(u)?j(t)?nn(u,t[0],t[1]):N(t)?nn(u,t):void Y("Invalid argument type for $slice projection operator"):u},$stdDevPop:function(n,t,e){var r=m(n,t,e);return Z({dataset:r,sampled:!1})},$stdDevSamp:function(n,t,e){var r=m(n,t,e);return Z({dataset:r,sampled:!0})}},yn={$addToSet:function(n,t){return X(this.$push(n,t))},$sum:function(n,t){return j(n)?N(t)?n.length*t:this.$push(n,t).filter(N).reduce(function(n,t){return n+t},0):0},$max:function(n,t){var e=this.$push(n,t),r=void 0;return e.length>0&&(r=e[0],J(e,function(n){n>r&&(r=n)})),r},$min:function(n,t){var e=this.$push(n,t),r=void 0;return e.length>0&&(r=e[0],J(e,function(n){r>n&&(r=n)})),r},$avg:function(n,t){var e=this.$push(n,t).filter(N),r=e.reduce(function(n,t){return n+t},0);return r/(e.length||1)},$push:function(n,t){return P(t)?a(n):n.map(function(n){return m(n,t,null)})},$first:function(n,t){return n.length>0?m(n[0],t):void 0},$last:function(n,t){return n.length>0?m(n[n.length-1],t):void 0},$stdDevPop:function(n,t){var e=this.$push(n,t).filter(N);return Z({dataset:e,sampled:!1})},$stdDevSamp:function(n,t){var e=this.$push(n,t).filter(N);return Z({dataset:e,sampled:!0})}},mn={$abs:function(n,t){var e=m(n,t,null);return null===e||void 0===e?null:Math.abs(e)},$add:function(n,t){var e=m(n,t,null);return e.reduce(function(n,t){return n+t},0)},$ceil:function(n,t){var e=m(n,t,null);return isNaN(e)?NaN:P(e)?null:(b(N(e),"$ceil must be a valid expression that resolves to a number."),Math.ceil(e))},$divide:function(n,t){var e=m(n,t,null);return e[0]/e[1]},$exp:function(n,t){var e=m(n,t,null);return isNaN(e)?NaN:P(e)?null:(b(N(e),"$exp must be a valid expression that resolves to a number."),Math.exp(e))},$floor:function(n,t){var e=m(n,t,null);return isNaN(e)?NaN:P(e)?null:(b(N(e),"$floor must be a valid expression that resolves to a number."),Math.floor(e))},$ln:function(n,t){var e=m(n,t,null);return isNaN(e)?NaN:P(e)?null:(b(N(e),"$ln must be a valid expression that resolves to a number."),Math.log(e))},$log:function(n,t){var e=m(n,t,null);return b(j(e)&&2===e.length,"$log must be a valid expression that resolves to an array of 2 items"),e.some(isNaN)?NaN:e.some(P)?null:(b(e.every(N),"$log expression must resolve to array of 2 numbers"),Math.log10(e[0])/Math.log10(e[1]))},$log10:function(n,t){var e=m(n,t,null);return isNaN(e)?NaN:P(e)?null:(b(N(e),"$log10 must be a valid expression that resolves to a number."),Math.log10(e))},$mod:function(n,t){var e=m(n,t,null);return e[0]%e[1]},$multiply:function(n,t){var e=m(n,t,null);return e.reduce(function(n,t){return n*t},1)},$pow:function(n,t){var e=m(n,t,null);return b(j(e)&&2===e.length&&e.every(N),"$pow must be a valid expression that resolves to an array of 2 numbers"),0===e[0]&&e[1]<0&&Y("$pow cannot raise 0 to a negative exponent"),Math.pow(e[0],e[1])},$sqrt:function(n,t){var e=m(n,t,null);return isNaN(e)?NaN:P(e)?null:(b(N(e)&&e>0,"$sqrt must be a valid expression that resolves to a non-negative number."),Math.sqrt(e))},$subtract:function(n,t){var e=m(n,t,null);return e[0]-e[1]},$trunc:function(n,t){var e=m(n,t,null);return isNaN(e)?NaN:P(e)?null:(b(N(e)&&e>0,"$trunc must be a valid expression that resolves to a non-negative number."),Math.trunc(e))}},bn={$concat:function(n,t){var e=m(n,t,null);return[null,void 0].some(R.bind(null,e))?null:e.join("")},$indexOfBytes:function(n,t){var e=m(n,t,null);if(P(e[0]))return null;b(w(e[0]),"$indexOfBytes first operand must resolve to a string"),b(w(e[1]),"$indexOfBytes second operand must resolve to a string");var r=e[0],u=e[1],i=e[2],o=e[3];if(b(q(i)||N(i)&&i>=0&&Math.round(i)===i,"$indexOfBytes third operand must resolve to a non-negative integer"),i=i||0,b(q(o)||N(o)&&o>=0&&Math.round(o)===o,"$indexOfBytes fourth operand must resolve to a non-negative integer"),o=o||r.length,i>o)return-1;var l=r.substring(i,o).indexOf(u);return l>-1?l+i:l},$split:function(n,t){var e=m(n,t,null);return b(w(e[0]),"$split requires an expression that evaluates to a string as a first argument, found: "+B(e[0])),b(w(e[1]),"$split requires an expression that evaluates to a string as a second argument, found: "+B(e[1])),e[0].split(e[1])},$strcasecmp:function(n,t){var e=m(n,t,null);return e[0]=U(e[0])?"":e[0].toUpperCase(),e[1]=U(e[1])?"":e[1].toUpperCase(),e[0]>e[1]?1:e[0]<e[1]?-1:0},$substr:function(n,t){var e=m(n,t,null);return w(e[0])?e[1]<0?"":e[2]<0?e[0].substr(e[1]):e[0].substr(e[1],e[2]):""},$toLower:function(n,t){var e=m(n,t,null);return U(e)?"":e.toLowerCase()},$toUpper:function(n,t){var e=m(n,t,null);return U(e)?"":e.toUpperCase()}},_n={$dayOfYear:function(n,t){var e=m(n,t,null);if(C(e)){var r=new Date(e.getFullYear(),0,0),u=e-r,i=864e5;return Math.round(u/i)}},$dayOfMonth:function(n,t){var e=m(n,t,null);return C(e)?e.getDate():void 0},$dayOfWeek:function(n,t){var e=m(n,t,null);return C(e)?e.getDay()+1:void 0},$year:function(n,t){var e=m(n,t,null);return C(e)?e.getFullYear():void 0},$month:function(n,t){var e=m(n,t,null);return C(e)?e.getMonth()+1:void 0},$week:function(n,t){var e=m(n,t,null);e=new Date(+e),e.setHours(0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));var r=new Date(e.getFullYear(),0,1);return Math.floor(((e-r)/864e5+1)/7)},$hour:function(n,t){var e=m(n,t,null);return C(e)?e.getUTCHours():void 0},$minute:function(n,t){var e=m(n,t,null);return C(e)?e.getMinutes():void 0},$second:function(n,t){var e=m(n,t,null);return C(e)?e.getSeconds():void 0},$millisecond:function(n,t){var e=m(n,t,null);return C(e)?e.getMilliseconds():void 0},$dateToString:function(n,t){for(var e=t.format,r=m(n,t.date,null),u=e.match(/(%%|%Y|%m|%d|%H|%M|%S|%L|%j|%w|%U)/g),i=0,o=u.length;o>i;i++){var l=Un[u[i]],a=l;if(j(l)){var s=this[l[0]],c=l[1];a=v(s.call(this,n,r),c)}e=e.replace(u[i],a)}return e}},xn={$setEquals:function(n,t){var e=m(n,t,null),r=X(e[0]),u=X(e[1]);return r.length===u.length&&r.length===H(r,u).length},$setIntersection:function(n,t){var e=m(n,t,null);return H(e[0],e[1])},$setDifference:function(n,t){var e=m(n,t,null);return e[0].filter(D.bind(null,e[1]))},$setUnion:function(n,t){var e=m(n,t,null);return K(e[0],e[1])},$setIsSubset:function(n,t){var e=m(n,t,null);return H(e[0],e[1]).length===e[0].length},$anyElementTrue:function(n,t){var e=m(n,t,null)[0];return e.some(T)},$allElementsTrue:function(n,t){var e=m(n,t,null)[0];return e.every(T)}},On={$cond:function(n,t){var e=void 0,r=void 0,u=void 0;j(t)?(3!==t.length&&Y("Invalid arguments for $cond operator"),e=t[0],r=t[1],u=t[2]):M(t)&&(e=t["if"],r=t.then,u=t["else"]);var i=m(n,e,null);return i?m(n,r,null):m(n,u,null)},$switch:function(n,t){t.branches||Y("Invalid arguments for $switch operator");var e=t.branches.find(function(t){return t["case"]&&t.then||Y("Invalid arguments for $switch operator"),m(n,t["case"],null)});return e?m(n,e.then,null):t["default"]?m(n,t["default"],null):void Y("Invalid arguments for $switch operator")},$ifNull:function(n,t){b(j(t)&&2===t.length,"Invalid arguments for $ifNull operator");var e=m(n,t,null);return null===e[0]||void 0===e[0]?e[1]:e[0]}},kn={$cmp:function(n,t){var e=m(n,t,null);return e[0]>e[1]?1:e[0]<e[1]?-1:0}};J(["$eq","$ne","$gt","$gte","$lt","$lte","$in","$nin"],function(n){kn[n]=function(t,e){var r=m(t,e,null),u=_slicedToArray(r,2),i=u[0],o=u[1];return gn[n](i,o)}});var wn={$arrayElemAt:function(n,t){var e=m(n,t,null);b(j(e)&&2===e.length,"$arrayElemAt expression must resolve to an array of 2 elements"),b(j(e[0]),"First operand to $arrayElemAt must resolve to an array"),b(N(e[1]),"Second operand to $arrayElemAt must resolve to an integer");var r=e[1];return e=e[0],0>r&&Math.abs(r)<=e.length?e[r+e.length]:r>=0&&r<e.length?e[r]:void 0},$concatArrays:function(n,t){var e=m(n,t,null);return b(j(e)&&2===e.length,"$concatArrays expression must resolve to an array of 2 elements"),e.some(P)?null:e[0].concat(e[1])},$filter:function(n,t){var e=m(n,t.input,null),r=t.as,u=t.cond;return b(j(e),"'input' expression for $filter must resolve to an array"),e.filter(function(n){var t={};return t["$"+r]=n,m(t,u,null)===!0})},$indexOfArray:function(n,t){var e=m(n,t,null);if(P(e))return null;var r=e[0];if(P(r))return null;b(j(r),"First operand for $indexOfArray must resolve to an array.");var u=e[1];if(P(u))return null;var i=e[2]||0,o=e[3]||r.length;return o<r.length&&(r=r.slice(i,o)),r.indexOf(u,i)},$isArray:function(n,t){return j(m(n,t,null))},$range:function(n,t){for(var e=m(n,t,null),r=_slicedToArray(e,3),u=r[0],i=r[1],o=r[2],l=void 0===o?1:o,a=[];i>u&&l>0||u>i&&0>l;)a.push(u),u+=l;return a},$reverseArray:function(n,t){var e=m(n,t,null);return P(e)?null:(b(j(e),"$reverseArray expression must resolve to an array"),e=a(e),e.reverse(),e)},$reduce:function(n,t){var e=m(n,t.input,null),r=m(n,t.initialValue,null),u=t["in"];return P(e)?null:(b(j(e),"'input' expression for $reduce must resolve to an array"),e.reduce(function(n,t){return m({$value:n,$this:t},u,null)},r))},$size:function(n,t){var e=m(n,t,null);return j(e)?e.length:void 0},$slice:function(n,t){var e=m(n,t,null);return nn(a(e[0]),e[1],e[2])},$zip:function(n,t){var e=m(n,t.inputs,null),r=t.useLongestLength||!1;b(j(e),"'inputs' expression must resolve to an array"),b(k(r),"'useLongestLength' must be a boolean"),j(t.defaults)&&b(T(r),"'useLongestLength' must be set to true to use 'defaults'");var u=0,i=void 0,o=void 0;for(o=0;o<e.length;o++){if(i=e[o],P(i))return null;b(j(i),"'inputs' expression values must resolve to an array or null"),u=r?Math.max(u,i.length):Math.min(u||i.length,i.length)}var l=[],a=t.defaults||[];for(o=0;u>o;o++)i=e.map(function(n,t){return P(n[o])?a[t]||null:n[o]}),l.push(i);return l}},Nn={$literal:function(n,t){return t}},jn={$map:function(n,t){var e=m(n,t.input,null);j(e)||Y("Input expression for $map must resolve to an array");var r=t.as,u=t["in"],i="$"+r,o=n[i];return e.map(function(t){n[i]=t;var e=m(n,u,null);return q(o)?delete n[i]:n[i]=o,e})},$let:function(n,t){var e=t.vars,r=t["in"],u={},i=z(e);J(i,function(t){var r=m(n,e[t],null),i="$"+t;u[i]=n[i],n[i]=r});var o=m(n,r,null);return J(i,function(t){var e="$"+t;q(u[e])?delete n[e]:n[e]=u[e]}),o}},Mn={$and:function(n,t){var e=m(n,t,null);return T(e)&&e.every(T)},$or:function(n,t){var e=m(n,t,null);return T(e)&&e.some(T)},$not:function(n,t){return!m(n,t[0],null)}},An=Object.assign({},wn,mn,Mn,kn,On,_n,Nn,xn,bn,jn),Cn={$$ROOT:function(n,t,e){return e.root},$$CURRENT:function(n,t,e){return n}},In={$$KEEP:function(n,t,e){return n},$$PRUNE:function(n,t,e){},$$DESCEND:function(n,e,r){if(!F(e,"$cond"))return n;var u=void 0;return J(n,function(i,o){A(i)&&(j(i)?(u=[],J(i,function(n,i){M(n)&&(n=t(n,e,r)),q(n)||u.push(n)})):u=t(i,e,r),q(u)?delete n[o]:n[o]=u)}),n}},Sn=z(Cn),En=z(In),qn=en.OP_QUERY="query",Pn=en.OP_GROUP="group",Dn=en.OP_AGGREGATE="aggregate",Rn=en.OP_PIPELINE="pipeline",Tn=en.OP_PROJECTION="projection",Ln={aggregate:An,group:yn,pipeline:dn,projection:$n,query:hn},Un={"%Y":["$year",4],"%m":["$month",2],"%d":["$dayOfMonth",2],"%H":["$hour",2],"%M":["$minute",2],"%S":["$second",2],"%L":["$millisecond",3],"%j":["$dayOfYear",3],"%w":["$dayOfWeek",1],"%U":["$week",2],"%%":"%"},Qn=[w,k,N,C,P,I];en.VERSION=tn}(this);
//# sourceMappingURL=dist/mingo.min.map